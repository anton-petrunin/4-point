\documentclass[a4paper,10pt]{article}
\usepackage{paper-en}
\usepackage{hyperref}




%\usepackage[notref,notcite,color]{showkeys}



\def\thetitle{Convex cones of metrics}
\def\theauthors{Nina Lebedeva, Anton Petrunin, and Vladimir Zolotov}

\hypersetup{colorlinks=true,
citecolor=black,
linkcolor=black,
anchorcolor=black,
filecolor=black,
menucolor=black,
urlcolor=black,
pdftitle={\thetitle},
pdfauthor={\theauthors}
}








%\usepackage[a-2b,mathxmp]{pdfx}[2018/12/22]
%\overfullrule=100mm
%\usepackage[none]{hyphenat}
\begin{document}
%\pagestyle{empty}\renewcommand\includegraphics[2][{}]{}


\title{\thetitle}
\author{\theauthors}
\date{}
\maketitle

\begin{abstract}
We study the effect on metric spaces imposed by quadratic inequalities on the six distances between points in every quadruple.
\end{abstract}

\section{Quadratic inequality}\label{par:quadratic-inq}

Suppose $a_{i,j}$ are components of a symmetric $n{\times}n$ matrix.
We are interested in length spaces $X$ that
satisfy the inequalities of the following type
\[\sum_{i,j}a_{i,j}\cdot|x_i-x_j|_X^2\ge 0\]
for any $n$-point array $\bm{x}\z=(x_1,\dots,x_n)$ in $X$.
The inequality of this type will be called \emph{quadratic}.


Nonnegative and nonpositive curvature in the sense of Alexandrov can be described by inequalities of that type for $n=4$.
Namely they are described by the so-called inequalities of negative type $(3,1)$ and $(2,2)$ respectively; see Section~\ref{par:rank-one}.
This observation motivated us to investigate the entire class of such inequalities.
We certainly want to tackle the case $n>4$, but only after the simplest case $n=4$, which is the main subject of this paper.

Our paper contains several simple observations, but all together they form something interesting and nontrivial; it also opens ground for further investigations.
We define an associated quadratic form for a point array in a metric space (Section~\ref{Associated form})
and discuss inequalities of negative type (Section~\ref{par:rank-one}).
Further we prove a new version of a theorem of Abraham Wald \cite[§ 7]{wald} that describes metrics of all possible 4-point arrays Alexandrov spaces with nonnegative and nonpositive curvature;
see Section~\ref{Four-point arrays}.
Further, we show that Alexandrov spaces with nonnegative and nonpositive curvature can be defined by arbitrary inequality of negative type $(3,1)$ and $(2,2)$ respectively;
see Section~\ref{Alexandrov's comparison}.
Finally, we show that nontrivial case of globalization theorem holds only for Alexandrov spaces with nonnegative curvature, in other words for inequalities of negative type $(3,1)$;
see Section~\ref{par:globalization}.


\section{Associated form}\label{Associated form}
Let $\bm{x}=(x_1,\dots,x_n)$ be a point array in a metric space, and let $V\z=\RR^{n-1}$.
Choose once for all a unit-edge regular simplex $\triangle$ in $V$; denote by $v_1,\dots,v_n$ its vertices.
Note that $V$ comes with natural Euclidean structure.
Consider quadratic form $\rho_{\bm{x}}$ on $V$ that is defined by the equalities
\[\rho_{\bm{x}}(v_i-v_j)=|x_i-x_j|^2_X\] 
for all $i$ and $j$.

The quadratic form $\rho_{\bm{x}}$ will be called the \emph{associated form} of $\bm{x}=(x_1,\z\dots,x_n)$;
it is uniquely defined and remembers all distances $|x_i-x_j|_X$
(we assume that the simplex $\triangle$ in $V$ is known).

The Euclidean structure on $V$ identifies it with $V^*$.
The space of quadratic forms over $V$ will be denoted by $W$;
it is the symmetric square of $V=V^*$, and can be written as $W=S^2(V^*)=S^2(V)$.
Any quadratic inequalities described above define linear inequalities on $W$, so it can be written as $\langle\omega,\rho_{\bm{x}}\rangle\ge 0$ for a fixed $\omega\in W$.

This makes it possible to redefine the spaces that we are going to consider can be described the following way.

Let $K$ be a convex cone in $W$;
that is, $K$ is a nonempty set such that if $v,w\in K$, then $a\cdot v+b\cdot w\in K$ for any $a,b\ge0$.
Denote by $\mathcal{M}_K$ the class of all length spaces $X$ such that
$\rho_{\bm{x}}\in K$ for any $n$-point array $\bm{x}\z=(x_1,\dots,x_n)$ in $X$.
The class $\mathcal{M}_K$ respects distance-preserving embedding; that is
if there is a distance-preserving embedding $X\to Y$ between length spaces and $Y \in  \mathcal{M}_K$, then $X\in \mathcal{M}_K$.

Suppose $X,Y\in  \mathcal{M}_K$ and $a\ge 0$.
Since $K$ is convex,  $X\times Y$ and $a\cdot X$ are in $\mathcal{M}_K$;
here $X\times Y$ denotes $\ell_2$-product of metric spaces, and 
$a\cdot X$ denotes the rescaled copy of of $X$ with factor $a$. 

The last observation can be used in the opposite direction as well.
It gives that all forms $\rho_{\bm{x}}$ for point arrays in $\mathcal{M}_K$-spaces form a convex cone, say $K'$.

Evidently $K'\subset K$.
This inclusion might be strict.
First reason comes form the triangle inequality, which is equivalent to $\rho_{\bm{x}}(w)\ge 0$ for any vector $w$ in a 2-face of $\triangle$.
These inequalities must hold for any form in $K'$.
Furthermore, if $\rho_{\bm{x}}\in K'$, then $\rho_{\bm{y}}\in K'$ for any $n$-point array $\bm{y}$ made from the points of $\bm{x}$; in particular $\bm{y}$ might be a permutation of points in $\bm{x}$.

These two conditions hold for all metrics (not necessary intrinsic),
and one cannot get more for general metric spaces.
The next observation already use length-metricness.

\begin{thm}{Observation}
If $K$ is closed convex cone in $W$.
Then $K'$ is closed.
Moreover, $\mathcal{M}_K$ is closed under ultralimits.
\end{thm}


(For \emph{ultralimits} and \emph{ultracompletions} of metric spaces and all related topics, see, for example, \cite{petrunin2023}.)

\parit{Proof.}
The last statement is evident, and it implies the first statement.

Indeed, for any sequence of spaces $X_n$ in $\mathcal{M}_K$, its ultralimit $X_\omega$ also belongs to $\mathcal{M}_K$.
Therefore, given a sequence of point arrays $\bm{x}_n$ in $X_n$,
its limit $\bm{x}_\omega$ in $X_\omega$ has limit distances between corresponding points.
Hence the result.
\qeds

\begin{thm}{Proposition}\label{prop:Associated form}
Let $K$ be a closed convex cone in $W$ such that $K=K'$.
If $K$ is nontrivial (that is, $K\ne \{0\}$), then $\mathcal{M}_K$ contains all Euclidean spaces.
\end{thm}

\parit{Proof.}
Since $K$ is nontrivial, $\mathcal{M}_K$ contains a space, say $X$, with two distinct points.
Consider the ultracompletion $X^\omega$ of $X$;
recall that $X$ can be (and will be) considered as a subset of $X^\omega$.
Since $K$ is closed, the observation implies that $X^\omega\in \mathcal{M}_K$.

Since  $X$ is a length space, $X^\omega$ has to be geodesic.
Since $X^\omega$ contains pair of distinct point, it must contain a nontrivial geodesic.
It follows that $\mathcal{M}_K$ contains a line segment.
Rescaling the seqment and passing to the ultralimit, we get $\RR\in \mathcal{M}_K$;
passing to the products of $\RR$, we get the result. 
\qeds

Let us denote by $Q$ the cone of nonnegative quadratic forms in $W$.
Its dual cone $Q^*\subset W^*=S^2(V)$ is the space of generated by tensor squares of vectors in $V$. 

\begin{thm}{Corollary}
Let $K$ be a closed convex cone in $W$ such that $K=K'$.
Then either $K\supset Q$ or $K$ is the trivial; that is, $K=\{0\}$.
\end{thm}

\parit{Proof.}
Since $\RR\in \mathcal{M}_K$, we get that $\ell^2\in K$ for any linear function $\ell\:V\to\RR$.
By the spectral theorem, any form in $Q$ can be written as a sum of squares of linear functions, hence the result.
\qeds

\section{Rank-one inequalities}\label{par:rank-one}
Recall that $\rho_{\bm{x}}$ denotes the associated quadratic form for a given point array $\bm{x}=(x_1,\dots,x_n)$.

\begin{thm}{Observation}\label{obs:rank-one}
A given point array $\bm{x}=(x_1,\dots,x_n)$ is isometric to an array in a Euclidean space if and only if $\rho_{\bm{x}}(v)\ge 0$ for any vector $v$.
\end{thm}

An inequality of type $\rho_{\bm{x}}(v)\ge 0$ for a fixed vector $v\in V$ will be called rank-one inequality.

It is a partial case of quadratic inequality.
In the notations of Section~\ref{par:quadratic-inq}, it means that $a_{i,j}=-\lambda_i\cdot\lambda_j$ for a real array $(\lambda_1,\dots \lambda_n)$ such that
$\lambda_1+\dots+\lambda_n=0$.
These inequalities are also known as inequalities of \emph{negative type} \cite{deza-lauren}.
If in the array $(\lambda_1,\dots \lambda_n)$ contains $i$ positive and $j$ negative numbers,
then we say that this is an inequality of \emph{negative type} $(i,j)$.
Since changing the sign of all $\lambda_i$ does not change the inequality, we can always assume that $i\ge j$.

\section{Four-point arrays}\label{Four-point arrays}
Now suppose that $n=4$.
In this case, we have two interesting types of the rank-one inequalities: $(2,2)$ and $(3,1)$.
The case $(1,1)$ is trivial and 
the case $(2,1)$ follows from the triangle inequality.
In fact the triangle inequality is equivalent to all inequalities of negative type $(2,1)$.

Consider a rank-one inequality $\rho_{\bm{x}}(v)\ge 0$; we may assume that $v$ is a unit vector.
Furthermore, we may assume that it lies in a closed hemisphere bounded by an equator in direction of one of the the facets of $\triangle$.
These equators divide the hemisphere into triangles and quadrangles.
The inequality $\rho_{\bm{x}}(v)\ge 0$ has negative type $(2,2)$ or $(3,1)$
if and only if $v$ lies in the interior of a triangle or a quadrangle, respectfully.

\begin{wrapfigure}{o}{36mm}
\centering
\vskip-4mm
\includegraphics{mppics/pic-20}
\vskip-0mm
\end{wrapfigure}

If a vector $v$ is parallel to a facet of $\triangle$, then $\rho_{\bm{x}}(v)\ge 0$ is an inequality negative type $(2,1)$, which follows from the triangle inequality.
The picture shows the hemisphere.
The label on edges show which triangle inequality becomes equality if $\rho_{\bm{x}}$ vanish at some vector on this edge;
for example, label $123$ means that
\[|x_1-x_2|+|x_2-x_3|=|x_1-x_3|.\]
If $\rho_{\bm{x}}$ vanish on the intersection of equators, then two points in the array have to coincide;
the label shows which pair.
For example if it is marked by $12$, then $x_1=x_2$.

\begin{thm}{Proposition}\label{prop:Four-point arrays}
Let $X$ be a 4-point metric space.

If $X$ satisfies all inequalities of negative type $(3, 1)$, then it admits an isometric embedding into the product $r\cdot \mathbb{S}^1\times\RR^3$ for some $r>0$.

If $X$ satisfies all inequalities of negative type $(2, 2)$, then it admits an isometric embedding into the product $T\times\RR^3$, where $T$ denotes the \emph{tripod};
that is, three half-lines glued along the base points.
\end{thm}

Inequalities of negative type $(3, 1)$ hold in Alexandrov spaces with nonnegative curvature; it follows from the so-called Lang--Schroeder--Sturm inequality \cite{lang-schroeder, sturm}.
Similarly, inequalities of negative type $(2, 2)$ hold in Alexandrov spaces with nonpositive curvature; it follows from \cite[9.5]{AKP-2024}.
Since the tripod $T$ has nonpositive curvature, and $\mathbb{S}^1$ has nonnegative curvature in the sense of Alexandrov, we get the following corollary, which also follows from the result of Abraham Wald \cite[§ 7]{wald}.

\begin{thm}{Corollary}\label{cor:Four-point arrays}
A 4-point metric space $X$ is isometric to subset in a length space with nonpositive (nonnegative) curvature in the sense of Alexandrov if and only if all inequalities of negative type $(3, 1)$ (respectively, type $(2, 2)$) hold in $X$.
\end{thm}

More general five-point versions of this corollary were already proved by Tetsu Toyoda \cite{toyoda,lebedeva-petrunin2021} and the first two authors \cite{lebedeva-petrunin-2024}, respectively.


\parit{Proof.}
Let us enumerate points in $X$ and let $\rho$ be the associated form on $\RR^3$.
If $\rho\ge 0$, then $X$ is isometric to a 4-point subset in the Euclidean 3-space,
and there is nothing to prove.

Choose a minimal form $\tilde\rho\le \rho$ such that all $(2,1)$ inequalities hold for $\tilde\rho$;
here $\tilde\rho\le \rho$ means that $\tilde\rho(v)\le \rho(v)$ for any vector $v$.
Consider the (semi)metric on $X$ with the associated form $\tilde\rho$; denote by
$\tilde X$ the corresponding metric space.
If $X$ satisfies all inequalities of negative type $(3, 1)$ or $(2,2)$, then so does $\tilde X$.

By \ref{obs:rank-one}, $X$ isometrically embeds into $\tilde X\times \RR^3$.
Hence it is sufficient to show that $\tilde X$ embeds into $T$, or, correspondingly, into $r\cdot \mathbb{S}^1$ for some $r>0$.

Let $N\subset \mathbb{S}^2$ be a set where $\tilde\rho$ is negative and let $\bar N$ be its closure.
The set $N$ is nonempty; otherwise we are in the case $\rho\ge 0$, which is already covered.

Since all $(2,1)$-inequalities hold for $\tilde\rho$,
it must be nonnegative in on 4 equators $e_1,e_2,e_3,e_4$ in the directions of facets of $\triangle$.
Since $\tilde\rho$ is minimal, $\bar N$ has to touch $e_i$ at least at 3 directions (up to sign). 
If not, then there is a linear function, say $\ell$, that vanish at all common points of $\bar N$ and $e_i$ for all $i$.
In this case, consider the form $\tilde\rho-\eps\cdot \ell^2$ for small $\eps>0$.
Note that all $(2,1)$-inequalities still hold for this form;
therefore, $\tilde\rho$ is not minimal --- a contradiction.

It means that $\bar N$ lies in a quadrangle or triangle respectively and touches its sides at three points or more.

In the case of triangle, $\bar N$ has to touch all of its sides.
The diagram shows that after relabeling, we can assume that 
\begin{align*}
|x_1-x_2|&=|x_1-x_4|+|x_4-x_2|,
\\
|x_2-x_3|&=|x_2-x_4|+|x_4-x_3|,
\\
|x_3-x_1|&=|x_3-x_4|+|x_4-x_1|.
\end{align*}
In this case the array is embeddable in $T$.

In the case of quadrangle, $\bar N$ touches at least three of its sides (but might touch all four).
The diagram shows that after relabeling, we can assume that 
\begin{align*}
|x_1-x_4|&=|x_1-x_2|+|x_2-x_4|=|x_1-x_3|+|x_3-x_4|,
\\
|x_2-x_3|&=|x_2-x_4|+|x_4-x_3|.
\end{align*}
(If it touches all sides, then in addition we have $|x_2-x_3|=|x_2-x_1|+|x_1-x_3|$.)
In any case, the array is embeddable in $r\cdot \mathbb{S}^1$, where $r=|x_1-x_4|/\pi$.
\qeds

The following picture shows possible positions of the set $N$.
\begin{figure}[h!]
\centering
\vskip-0mm
\includegraphics{mppics/pic-30}
\vskip-0mm
\end{figure}
Below it we draw a diagram following the convention from \cite{lebedeva-petrunin-2010};
if three points, say $x_1$, $x_2$, and $x_3$, uppear in this order on a smooth line, then $|x_1-x_2|+|x_2-x_3|=|x_1-x_3|$.


\section{Alexandrov's comparison}\label{Alexandrov's comparison}
In terms of $v$, inequalities of negative type $(2,2)$ means that $v$ points from one edge of $\triangle$ to the opposite edge;
the type $(3,1)$ means that $v$ points from a vertex to the opposite face (or in the opposite direction).

\begin{thm}{Proposition}\label{prop:Alexandrov's comparison}
Suppose $K\subset W$ is defined by one rank-one inequality on four-point arrays.
\begin{enumerate}[(i)]
\item If the inequality is of negative type $(2,2)$, then $\mathcal{M}_K$ consists all length spaces with nonpositive curvature in the sense of Alexandrov.
\item If the inequality is of negative type $(3,1)$, then $\mathcal{M}_K$ consists all length spaces with nonnegative curvature in the sense of Alexandrov.
\item In the remaining cases, $\mathcal{M}_K$ consists all length spaces.
\end{enumerate}

\end{thm}

The proof is a straightforward combination of the arguments by Takashi Sato \cite{sato} and its variation by the first two authors \cite{lebedeva-petrunin-2010}.
These papers consider particular cases of $(2,2)$ and $(3,1)$ inequalities, namely for $\lambda$-arrays $(1,1,-1,-1)$ and $(1,1,1,-3)$, respectively.

\parit{Proof.}
Our inequality can be written as 
\[\sum_{i,j}\lambda_i\cdot\lambda_j\cdot|x_i-x_j|_X^2\le 0,
\eqlbl{eq:lambda}
\]
where $\lambda_1+\lambda_2+\lambda_3+\lambda_4=0$.
If $\lambda_i=0$ for some $i$,
then the inequality follows from the triangle inequality.
It means that $\mathcal{M}_K$ consists of all length spaces.

It remains to consider the inequalities of negative type $(2,2)$ or $(3,1)$.
In these cases, we can and will assume that our $\lambda$-array is
\[(\alpha\cdot (1-\beta),\  (1-\alpha)\cdot(1-\beta),\  \beta,\ -1)\] 
for some $\alpha,\beta$ such that $0< \beta< 1$;
in case of $(2,2)$-inequality, $0< \alpha< 1$,
and
in case of $(3,1)$-inequality, $1< \alpha$.

Consider the 4-point array $\bm{x}=(x_1,x_2,x_3,x_4)$  in the plane such that 
\[x_4=\alpha\cdot (1-\beta)\cdot x_1+(1-\alpha)\cdot(1-\beta)\cdot x_2+\beta\cdot x_3.\]
We can assume that the array is enumerated so that we have a configuration as on one of the pictures below,
so for $(3,1)$-inequality, point $x_4$ lies inside of triangle $x_1x_2x_3$,
and for $(2,2)$-inequality segment $[x_1,x_3]$ intersects $[x_2,x_4]$.

Note that we get equality in \ref{eq:lambda} for this array.
Moreover, this defines bijection between $\bm{x}$-arrays up to affine transformation and $\lambda$-arrays up to multiplication by a nonzero coefficient;
as before, we assume that the $\bm{x}$-arrays are in general position --- three of its points do not lie on one line.
So we can describe our inequality by a 4-point array in general position.
If the points of the array lie in a vertices of a convex quadrangle,
then it corresponds to an inequalities of type $(2,2)$.
If one of the points in the array lie inside of the triangle formed by the remaining points, then it corresponds to an inequalities of type $(3,1)$.

\begin{figure}[ht!]
\vskip-0mm
\centering
\includegraphics{mppics/pic-10}
\vskip0mm
\end{figure}

Consider the affine transformation that sends $x_1\mapsto x_1$, $x_2\mapsto x_2$ and $x_3\mapsto x_4$;
let $x_5$ be the image of $x_4$ under this transformation; so \begin{align*}
x_5&=\alpha\cdot (1-\beta)\cdot x_1+(1-\alpha)\cdot(1-\beta)\cdot x_2+\beta\cdot x_4=
\\
&=\alpha\cdot (1-\beta^2)\cdot x_1+(1-\alpha)\cdot(1-\beta^2)\cdot x_2+\beta^2\cdot x_3.
\end{align*}
Note that $x_4$ lies between $x_3$ and $x_5$;
in particular $|x_3-x_4|+|x_4-x_5|=|x_3-x_5|$.

Consider the inequalities of type \ref{eq:lambda} that corresponds to array $x_1,x_2,x_3,x_4$ and $x_1,x_2,x_3,x_5$;
let us call them first and second.

\begin{thm}{Claim}
Suppose that the first inequality holds for any four-point array in a length space $X$, then so does the second inequality.
\end{thm}

Indeed, passing to the ultracompletion, we may assume that $X$ is geodesic.
Choose 4 points $x_1,x_2,x_3,x_5\in X$ and let $x_4$ be a point on a geodesic $[x_3,x_5]$ that divides it in the same ratio as in the 5-point configuration in the plane.
If we sum up the first inequality for arrays $x_1,x_2,x_3,x_4$ and $x_1,x_2,x_4,x_5$ with an appropriate coefficient, then we get the second inequality for $x_1,x_2,x_3,x_5$.

By the claim, the inequality for $\lambda$-array $(\alpha\cdot (1-\beta),(1-\alpha)\cdot(1-\beta), \beta,-1)$ implies the inequality for the $\lambda$-array $(\alpha\cdot (1-\beta^2), (1-\alpha)\cdot(1-\beta^2), \beta^2,-1)$.
Iterating the procedure, we get all the inequalities with $\lambda$-arrays
\[(\alpha\cdot (1-\gamma),\  (1-\alpha)\cdot(1-\gamma),\ \gamma,\ -1)\]
for $\gamma=\beta^{2^n}$ with any integer $n\ge 1$;
in particular, we get the following inequality
\[
\begin{aligned}
\alpha\cdot (1-\alpha)\cdot(1-\gamma)^2\cdot|x_1-x_2|^2 - \gamma\cdot |x_3-x_4|^2 &+
\\
+(1-\alpha)\cdot(1-\gamma)\cdot\gamma\cdot|x_2-x_3|^2-\alpha\cdot (1-\gamma)\cdot |x_1-x_4|^2&+
\\
+\alpha\cdot(1-\gamma)\cdot\gamma\cdot|x_1-x_3|^2-(1-\alpha)\cdot(1-\gamma)\cdot |x_2-x_4|^2&\le 0
\end{aligned}
\eqlbl{eq:lambda-inq}
\]
arbitrarily small $\gamma>0$.

Choose $X\in \mathcal{M}_K$.
Let us apply the corresponding inequality
\begin{figure}[ht!]
\vskip-0mm
\centering
\includegraphics{mppics/pic-15}
\vskip0mm
\end{figure}
a quadruple $x_1,x_2,x_3,x_4\in X$ such that $x_1$, $x_2$ and $x_4$ lie on one geodesic and we have equalitiy in the $(2,1)$-inequality with $\lambda$-array
\[(\alpha,\  (1-\alpha),\ 0,\ -1);\]
that is,
\[\alpha\cdot (1-\alpha)\cdot|x_1-x_2|^2-\alpha\cdot |x_1-x_4|^2-(1-\alpha)\cdot |x_2-x_4|^2=0.\eqlbl{eq:trig-inq}\]
%\[
%\begin{aligned}
%-\alpha\cdot (1-\alpha)\cdot(2-\gamma)\cdot|x_1-x_2|^2 -  |x_3-x_4|^2 &+
%\\
%+(1-\alpha)\cdot(1-\gamma)\cdot|x_2-x_3|^2+\alpha\cdot|x_1-x_4|^2&+
%\\
%+\alpha\cdot(1-\gamma)\cdot|x_1-x_3|^2+(1-\alpha)\cdot |x_2-x_4|^2&\le 0.
%\end{aligned}
%\]
%Since $\gamma>0$ can be taken arbitrary small, we get
%\[
%\begin{aligned}
%-2\cdot \alpha\cdot (1-\alpha)\cdot|x_1-x_2|^2 -  |x_3-x_4|^2 &+
%\\
%+(1-\alpha)\cdot|x_2-x_3|^2+\alpha\cdot|x_1-x_4|^2&+
%\\
%+\alpha\cdot|x_1-x_3|^2+(1-\alpha)\cdot |x_2-x_4|^2&\le 0.
%\end{aligned}
%\]
%Adding two \ref{eq:trig-inq} to the last inequality, we get

Passing to the limit $\gamma\to 0$ in the inequality \ref{eq:trig-inq}$\,+\,\tfrac1\gamma\cdot($\ref{eq:lambda-inq}$\,-\,$\ref{eq:trig-inq}$)$, we get
\[
\begin{aligned}
|x_3-x_4|^2&\ge
(1-\alpha)\cdot|x_3-x_2|^2+\alpha\cdot|x_3-x_1|^2-
\\
&-(1-\alpha)\cdot |x_4-x_2|^2-\alpha\cdot|x_4-x_1|^2.
\end{aligned}
\eqlbl{eq:CBB-CBA}
\]
Recall that nonnegative or nonpositive curvature in the sense of Alexandrov is defined via this inequality for all $\alpha\in (0,1)$ and $\alpha\in (1,\infty)$, respectively.
So far we get it only for one value of $\alpha$, but iterating this inequality we get it for the remaining values.

More precisely, assume this inequality holds for some $\alpha\in (0,1)$, then appying iteration we can choose $\alpha$ from the follwing nimbers: $(1-\alpha)$, $\alpha^2$,  $\alpha\cdot (1-\alpha)$, $(1-\alpha)^2$, and so on.
Together with any value $\xi$, this set contains $\alpha\cdot \xi$ and $(1-\alpha)\cdot\xi$.
Note that this set is dense in $(0,1)$.
Therefore, inequality \ref{eq:CBB-CBA} holds for any $\alpha\in (0,1)$; the latter is equivalent to the point-on-side comparison for nonnegative curvature; see \cite[8.14]{AKP-2024}.
Similarly one can show that if the inequality holds for some $\alpha>1$, then it holds for any $\alpha>1$,
and this is equivalent to the point-on-side comparison for nonpositive curvature; see \cite[9.14]{AKP-2024}.
\qeds


\section{Globalization}\label{par:globalization}
Suppose $K\subset W$ is closed convex cone.
We say that a metric space $X$ meets \emph{local $K$-comparison} if any point $x\in X$ admits a neighborhood $U$ such that $K$-comparison for any $n$-point array in $U$.

If local $K$-comparison implies $K$-comparison for any length space, then we say that \emph{globalization holds} for $K$.

\begin{thm}{Theorem}\label{thm:globalization}
Let $K\subset W=\RR^3$ be a closed cone.
Suppose that the globalization holds for $K$.
Assume that the $K$-comparison is not trivial; that is, $\mathcal{M}_K$ does not inlude all length spaces,
and $\mathcal{M}_K$ contains a space with at least two points.
Then $\mathcal{M}_K$ consists of Alexandrov spaces with nonnegative curvature.
\end{thm}

\begin{thm}{Lemma}\label{lem:globalization}
In the assumption of the theorem, $\mathcal{M}_K$ contains all Alexandrov spaces with nonnegative curvature.
\end{thm}

\parit{Proof.}
Since $K$-comparison is not trivial, $K\ne\{0\}$.
By \ref{prop:Associated form}, $\mathcal{M}_K$ contrains real line.
Therefore, local $K$-comparison holds for any circle $r\cdot \mathbb{S}^1$, and any prduct space $r\cdot \mathbb{S}^1\times\RR^3$ for any $r>0$.
It remains to apply \ref{prop:Four-point arrays}.
\qeds

\parit{Proof of the theorem.}
Let us denote by $K_0$ the cone in $\RR^3$ described by all inequalities of negaive type $(3,1)$ and $(2,1)$.
By \ref{cor:Four-point arrays}, $K_0$ describes all metrics on 4-point arrays in Alexandrov spaces with nonnegative curvature.
By \ref{lem:globalization},  $K$~includes $K_0$.

Given $\delta>0$, consider all metrics on the set $\{x_1,x_2,x_3,x_4\}$ such that for each $i$
the sum of three model angles at $x_i$ is at most $2\cdot\pi+\delta$; that is, inequality
\[\angk{x_4}{x_1}{x_2}+\angk{x_4}{x_2}{x_3}+\angk{x_4}{x_3}{x_1}\le 2\cdot\pi+\delta\]
remains valid after any relabeling of $\{x_1,x_2,x_3,x_4\}$.
Denote by $K_\delta\subset W$ the minimal closed convex cone that includes all associated forms of these metrics.
Note that $K_0\z\subset K_\delta$;
moreover, $K_0=\bigcap_{\delta>0} K_\delta$.

Since Riemannian manifolds are almost Euclidean at small scale,
any compact Riemannian manifold meets local $K_\delta$-comparison.

Suppose $K\supset K_\delta$ for some $\delta>0$.
Since the globalization holds for $K$, the class $\mathcal{M}_K$ contains all compact Riemannian manifolds.
Note that any finite metric graph can be approximated by compact Riemannian manifolds;
to prove it, embed the graph isometrically in the Euclidean space and pass to a boundary of an appropriate neighbourhood.
(A way stronger result is proved by Vedrin Šahović in his thesis \cite{sahovic2009}.)
Any metric on $\{x_1,x_2,x_3,x_4\}$ admits a distance-preserving embedding into a metric graph, so $K$ contains a form near the associated form for any metric on $\{x_1,x_2,x_3,x_4\}$.
Since $K$ is closed, it contais forms associated to all metrics on 4-point set, so it is solely defined by triangle inequalities;
in other words, $K$ is described by all inequalities of negative type $(2,1)$.
Hence $K$-comparison is trivial; in this case, $\mathcal{M}_K$ contains all length spaces.

From now on, we can assume that for any $\delta>0$ there is a from $\theta_\delta\in K_\delta\setminus K$.
Thus we can choose quadratic inequality that does not hold for $\theta_\delta$, but holds for any form in $K$.
Our inequality can be written as $\langle \omega,\rho_{\bm{x}} \rangle\ge 0$, where $\rho_{\bm{x}}\in W$ is an associated form of some 4-point array $(x_1,x_2,x_3,x_4)$ and $\omega$ is a fixed form in $W$.

(Recall that $V$ and $W$ come with natural scalar product; see Section~\ref{Associated form}.
In particular, we have indentification $V=V^*$ and $W=W^*$.
Note that the scalar product on $W$ satisfies the identity $\langle u^2,v^2\rangle=\langle u,v\rangle^2$ for $u,v\in V$.)

Let $N\subset \SSS^2\subset V$ be the set of unit vectors $v$ such that $\theta_\delta(v)<0$.
Note that $N$ does not intersect the four equators.
Moreover, since $K\supset K_0$, the set $N$ lies in one of triangles say $\Delta$;
we can assume that equators $e_1$, $e_2$, $e_3$ are extensions of sides $\Delta$, and $e_4$ is the remaining equator.

Since $K\supset K_0$, we have $\omega(v)\ge 0$ for any $v\in V$.
Let $u\in V$ be a unit vector perpendicular to the equator $e_4$.
By the spectral thereom, $\omega$ and $u^2$ can be diagonalized in common basis (which does not have to be orthonormal).
Therefore,
\[\langle \omega,\rho_{\bm{x}}\rangle=\rho_{\bm{x}}(v_1)+\rho_{\bm{x}}(v_2)+\rho_{\bm{x}}(v_3)\eqlbl{eq:v_123}\]
for fixed vectors $v_1,v_2,v_3\in V$ such that $v_2$ and $v_3$ point in the direction of the equator $e_4$ or vanish.

The inequalities $\rho_{\bm{x}}(v_2)\ge 0$ and
$\rho_{\bm{x}}(v_3)\ge 0$ are of type $(2,1)$;
they follow from the triangle inequality, so we always have that $\rho_{\bm{x}}(v_2)\ge 0$ and
$\rho_{\bm{x}}(v_3)\ge 0$.
Morevoer the values $\rho_{\bm{x}}(v_2)$ and $\rho_{\bm{x}}(v_3)$ depend only on sides of triange $[x_1x_2x_3]$.

\begin{wrapfigure}{o}{30mm}
\centering
\vskip-4mm
\includegraphics{mppics/pic-40}
\vskip-0mm
\end{wrapfigure}

Since
\begin{align*}
\langle\omega,\theta_\delta\rangle=\theta_\delta(v_1)+\theta_\delta(v_2)+\theta_\delta(v_3)&<0,
\\
\theta_\delta(v_2)&\ge0,
\\
\theta_\delta(v_3)&\ge0,
\end{align*}
 we have that $v_1$ points in a direction of $N$.
(In particular $N\ne\emptyset$.)
Therefore, $\rho_{\bm{x}}(v_1)\ge0$ is an inequality of negative type $(3,1)$.

Let $w_1$ be a partial limit of $v_1$ as $\delta\to 0$.
We have three options:
\begin{enumerate}[(i)]
\item\label{in} $w_1$ lies on $\Delta$, but not on its sides,
\item\label{side}$w_1$ lies on a side of $\Delta$, but is not its vertex,
\item\label{vertex} $w_1$ is a vertex of $\Delta$.
\end{enumerate}
Each case will be done separately.

\parit{Case \ref{in}.}
Note that $\rho_{\bm{x}}(w_1)\ge0$ is an inequality of negative type $(3,1)$.
Suppose $X\in \mathcal{M}_K$ and $\rho_{\bm{x}}$ is associated form of an aray $\bm{x}=(x_1, x_2, x_3, x_4)$ in $X$.
Let us show that $\rho_{\bm{x}}(w_1)\ge0$;
once it is done, it will remain to apply \ref{prop:Alexandrov's comparison}.

Assume $\rho_{\bm{x}}(w_1)<0$.
Observe that $[x_1x_2x_3]$ is nondegenerate, so each of the triangle inequality with vrtices $x_1$, $x_2$, and $x_3$ is strict.
Moreover,
\[\angk{x_4}{x_1}{x_2}+\angk{x_4}{x_2}{x_3}+\angk{x_4}{x_3}{x_1}>2\cdot\pi.\]
We can assume that $[x_1,x_2]$ is the longest of $[x_1x_2x_3]$.
Observe that the distances $|x_1-x_4|$, $|x_2-x_4|$, $|x_3-x_4|$ cannot exceed $|x_1-x_2|$.

Choose small $\eps>0$.
Redefine distances of $\{x_1,x_2,x_3,x_4\}$ by setting $|x_2-x_3|\z{\mathrel{:=}}(1-\eps)\cdot|x_2-x_3|$ and leaving the remaining five distances the same.
These new distances might fail to meet triangle inequality, but we still can produce its associated form;
denote it by $\rho_{\bm{x}}'$.
If $\delta$ is sufficiently small, then $\rho_{\bm{x}}'(v_1)\ge0$ (here $v_1$ depends on $\delta$).
It follows that $\rho_{\bm{x}}'(w_1)\ge0$;
passing to the limit as $\eps\to 0$, we get $\rho_{\bm{x}}(w_1)\ge0$.

\parit{Case \ref{side}.}
Note that $\rho_{\bm{x}}(w_1)\ge0$ is an inequality of negative type $(2,1)$;
let us assume that $(\alpha,(1-\alpha), 0,-1)$ is its $\lambda$-array.

Choose $X\in \mathcal{K}$ and a quadruple $x_1$, $x_2$, $x_3$, $x_4\in X$.
Let us prove inequality \ref{eq:CBB-CBA};
once it is done, it will remain to apply the final step in the proof of \ref{prop:Alexandrov's comparison}.

Assume the contrary.
In this case $[x_1x_2x_3]$ is nondegenerate, so each of the triangle inequality with vrtices $x_1$, $x_2$, and $x_3$ is strict; moreover $x_4$ lies on a geodesic $[x_1,x_2]$.
We can assume that $|x_2-x_3|\ge |x_1-x_3|$.

Again, choose small $\eps>0$, and redefine distances on $\{x_1,x_2,x_3,x_4\}$ by setting $|x_2-x_3|:=(1-\eps)\cdot|x_2-x_3|$ and leaving the remaining five distances the same; denote by $\rho_{\bm{x}}'$ its asociated form.
Again, if $\delta>0$ is sufficiently small, then $\rho_{\bm{x}}'(v_1)\ge0$.
It remains to repeat the derivation of \ref{eq:CBB-CBA} in the proof of \ref{prop:Alexandrov's comparison} and pass the the limit as $\eps\to 0$.

\parit{Case \ref{vertex}.}
Note that $\rho_{\bm{x}}(w_1)\ge0$ is an inequality of negative type $(1,1)$.
Let us assume that $(0,0, 1,-1)$ is its $\lambda$-array;
so, the inequality can be written as $|x_3-x_4|^2\ge 0$.

This case will be reduced to previous two using the manipulations with inequalites from the proof of \ref{prop:Alexandrov's comparison}.

Choose a sequence $\delta_n\to0$ such that $v_1=v_1(\delta_n)\to w_1$ as $n\to \infty$.
Let
\[(\alpha_n\cdot (1-\beta_n),\  (1-\alpha_n)\cdot(1-\beta_n),\  \beta_n,\ -1)\]
be the $\lambda$-arrays of the inequalities $\rho_{\bm{x}}(v_1(\delta_n))\ge 0$.
Note that $\alpha_n,\beta_n\in(0,1)$ and $\beta_n\to 1$ as $n\to\infty$.

Similarly to the above, choose small $\eps>0$, and redefine distances on $\{x_1$, $x_2$, $x_3$, $x_4\}$ by setting $|x_1-x_2|:=(1-\eps)\cdot|x_1-x_2|$ and leaving the remaining five distances the same; denote by $\rho_{\bm{x}}'$ its asociated form.
Note that $\rho_{\bm{x}}'(v_1(\delta_n))\ge0$ for all large $n$.
Applying the iteration procedure in \ref{prop:Alexandrov's comparison}.
we get that inequality for $\rho_{\bm{x}}'$ with $\lambda$-array
\[(\alpha_n\cdot (1-\beta_n^2),\  (1-\alpha_n)\cdot(1-\beta_n^2),\  \beta_n^2,\ -1)\]
for all large $n$.
Repeating this procedure several times we get inequality for $\rho_{\bm{x}}'$ with $\lambda$-array
\[(\alpha_n\cdot (1-\beta_n^{2^k}),\  (1-\alpha_n)\cdot(1-\beta_n^{2^k}),\  \beta_n^{2^k},\ -1)\]
Choosing $k=k(n)$ appropriately, we get inequality for $\rho_{\bm{x}}'$ with $\lambda$-array
\[(\alpha_n\cdot (1-\gamma_n),\  (1-\alpha_n)\cdot(1-\gamma_n),\  \gamma_n,\ -1)\]
with $\gamma_n\in[\tfrac12,\tfrac14]$.

Passing to a subsequence, we can assume that $\alpha_n\to \alpha$ and $\gamma_n\to \gamma$ as $n\to \infty$.
Note that $\gamma\in (0,1)$.
If $\alpha\in (0,1)$, then arguing as in case \ref{side} we get the result.
If $\alpha=0$ or $1$, then we should apply the argument in case \ref{side}.
\qeds

\section{Remarks}
The requiremnt that the cone $K$ is closed in \ref{thm:globalization} is necessary;
without it, the globalization holds for the cone described by inequality
\[|x_1-x_2|^2+|x_1-x_3|^2+|x_2-x_3|^2<4\cdot(|x_1-x_4|^2+|x_2-x_4|^2+|x_3-x_4|^2).\]
To check the statement note and use that this inequality forbids tripods.

It would be super-nice to find a quadratic inequality for $n$-point array that is essentailly different from the globalization theorem.
Some canditates can be found in our earlier paper \cite{lebedeva-petrunin-zolotov}.
Also it might be possible to prove an analog of our globalization theorem for simply connected spaces; which includes Cartan--Hadamrd theorem.

{\sloppy
\def\emph{\textit}
\printbibliography[heading=bibintoc]
\fussy
}

\end{document}
